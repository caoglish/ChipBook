"use strict";(self["webpackChunkchipbook"]=self["webpackChunkchipbook"]||[]).push([[294],{4294:function(e,l,a){a.r(l),a.d(l,{default:function(){return I}});var t=a(6768),r=a(4232),o=a(554),n=a(2729),i=a(1606),s=a(697),d=a(3745),c=a(61),u=a(5035),y=a(6935),p=a(2067),m=a(4587),f=a(9094),h=a(1247),k=a(7861),g=a(4600);const _=(0,m.j)({...(0,u.V)(),...(0,f.cJ)((0,c.O)(),["inline"])},"VCheckbox"),v=(0,h.RW)()({name:"VCheckbox",inheritAttrs:!1,props:_(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,l){let{attrs:a,slots:r}=l;const o=(0,p.q)(e,"modelValue"),{isFocused:n,focus:i,blur:s}=(0,y.i)(e),d=(0,k.v6)(),m=(0,t.EW)((()=>e.id||`checkbox-${d}`));return(0,g.C)((()=>{const[l,d]=(0,f.ph)(a),y=u.Z.filterProps(e),p=c.M.filterProps(e);return(0,t.bF)(u.Z,(0,t.v6)({class:["v-checkbox",e.class]},l,y,{modelValue:o.value,"onUpdate:modelValue":e=>o.value=e,id:m.value,focused:n.value,style:e.style}),{...r,default:e=>{let{id:l,messagesId:a,isDisabled:n,isReadonly:u,isValid:y}=e;return(0,t.bF)(c.M,(0,t.v6)(p,{id:l.value,"aria-describedby":a.value,disabled:n.value,readonly:u.value},d,{error:!1===y.value,modelValue:o.value,"onUpdate:modelValue":e=>o.value=e,onFocus:i,onBlur:s}),r)}})})),{}}});var b=a(6329),P=a(1772),F=a(9669),D=a(5728);const w={class:"headline"};function V(e,l,a,c,u,y){return(0,t.uX)(),(0,t.CE)("div",null,[(0,t.bF)(o.D,{color:"primary",onClick:e.openDialog},{default:(0,t.k6)((()=>l[6]||(l[6]=[(0,t.eW)("添加玩家")]))),_:1},8,["onClick"]),l[19]||(l[19]=(0,t.Lk)("h3",null,"可选择的玩家列表",-1)),(0,t.bF)(b.Py,{headers:e.headers,items:e.forSelectPlayers,"items-per-page":50},{"item.actions":(0,t.k6)((({item:a})=>[(0,t.bF)(o.D,{color:"primary",icon:"",onClick:l=>e.editPlayer(a)},{default:(0,t.k6)((()=>[(0,t.bF)(F.w,null,{default:(0,t.k6)((()=>l[7]||(l[7]=[(0,t.eW)("mdi-pencil")]))),_:1})])),_:2},1032,["onClick"]),(0,t.bF)(o.D,{color:"secondary",icon:"",onClick:l=>e.toggleAllowSelect(a.id)},{default:(0,t.k6)((()=>[(0,t.bF)(F.w,null,{default:(0,t.k6)((()=>l[8]||(l[8]=[(0,t.eW)("mdi-minus")]))),_:1})])),_:2},1032,["onClick"]),(0,t.bF)(o.D,{color:"error",icon:"",onClick:l=>e.confirmDeletePlayer(a.id)},{default:(0,t.k6)((()=>[(0,t.bF)(F.w,null,{default:(0,t.k6)((()=>l[9]||(l[9]=[(0,t.eW)("mdi-delete")]))),_:1})])),_:2},1032,["onClick"])])),_:1},8,["headers","items"]),l[20]||(l[20]=(0,t.Lk)("h3",null,"不允许选择的玩家列表",-1)),(0,t.bF)(b.Py,{headers:e.headers,items:e.notForSelectPlayers,"items-per-page":50},{"item.actions":(0,t.k6)((({item:a})=>[(0,t.bF)(o.D,{color:"primary",icon:"",onClick:l=>e.editPlayer(a)},{default:(0,t.k6)((()=>[(0,t.bF)(F.w,null,{default:(0,t.k6)((()=>l[10]||(l[10]=[(0,t.eW)("mdi-pencil")]))),_:1})])),_:2},1032,["onClick"]),(0,t.bF)(o.D,{color:"secondary",icon:"",onClick:l=>e.toggleAllowSelect(a.id)},{default:(0,t.k6)((()=>[(0,t.bF)(F.w,null,{default:(0,t.k6)((()=>l[11]||(l[11]=[(0,t.eW)("mdi-plus")]))),_:1})])),_:2},1032,["onClick"]),(0,t.bF)(o.D,{color:"error",icon:"",onClick:l=>e.confirmDeletePlayer(a.id)},{default:(0,t.k6)((()=>[(0,t.bF)(F.w,null,{default:(0,t.k6)((()=>l[12]||(l[12]=[(0,t.eW)("mdi-delete")]))),_:1})])),_:2},1032,["onClick"])])),_:1},8,["headers","items"]),(0,t.bF)(P.p,{modelValue:e.dialog,"onUpdate:modelValue":l[3]||(l[3]=l=>e.dialog=l),"max-width":"500px"},{default:(0,t.k6)((()=>[(0,t.bF)(n.J,null,{default:(0,t.k6)((()=>[(0,t.bF)(i.r,null,{default:(0,t.k6)((()=>[(0,t.Lk)("span",w,(0,r.v_)(e.editingPlayer?"编辑玩家":"添加玩家"),1)])),_:1}),(0,t.bF)(s.O,null,{default:(0,t.k6)((()=>[(0,t.bF)(D.W,{modelValue:e.player.player_name,"onUpdate:modelValue":l[0]||(l[0]=l=>e.player.player_name=l),label:"玩家固定名称",readonly:e.editingPlayer,color:e.editingPlayer?"grey":"primary",dense:e.editingPlayer,class:"readonly-text-field",required:""},null,8,["modelValue","readonly","color","dense"]),e.editingPlayer?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.Wv)(v,{key:0,modelValue:e.sameName,"onUpdate:modelValue":l[1]||(l[1]=l=>e.sameName=l),label:"玩家显示名称与玩家固定名称相同",onChange:e.syncDisplayName},null,8,["modelValue","onChange"])),!e.sameName||e.editingPlayer?((0,t.uX)(),(0,t.Wv)(D.W,{key:1,modelValue:e.player.player_display_name,"onUpdate:modelValue":l[2]||(l[2]=l=>e.player.player_display_name=l),label:"玩家显示名称",required:""},null,8,["modelValue"])):(0,t.Q3)("",!0)])),_:1}),(0,t.bF)(d.S,null,{default:(0,t.k6)((()=>[(0,t.bF)(o.D,{color:"blue darken-1",onClick:e.savePlayer},{default:(0,t.k6)((()=>l[13]||(l[13]=[(0,t.eW)("保存")]))),_:1},8,["onClick"]),(0,t.bF)(o.D,{color:"grey darken-1",onClick:e.closeDialog},{default:(0,t.k6)((()=>l[14]||(l[14]=[(0,t.eW)("取消")]))),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,t.bF)(P.p,{modelValue:e.deleteDialog,"onUpdate:modelValue":l[5]||(l[5]=l=>e.deleteDialog=l),"max-width":"400px"},{default:(0,t.k6)((()=>[(0,t.bF)(n.J,null,{default:(0,t.k6)((()=>[(0,t.bF)(i.r,{class:"headline"},{default:(0,t.k6)((()=>l[15]||(l[15]=[(0,t.eW)("确认删除")]))),_:1}),(0,t.bF)(s.O,null,{default:(0,t.k6)((()=>l[16]||(l[16]=[(0,t.eW)("您确定要删除这个玩家吗？此操作无法撤销。")]))),_:1}),(0,t.bF)(d.S,null,{default:(0,t.k6)((()=>[(0,t.bF)(o.D,{color:"red darken-1",onClick:l[4]||(l[4]=l=>e.deletePlayer(e.confirmedDeleteId))},{default:(0,t.k6)((()=>l[17]||(l[17]=[(0,t.eW)("确认")]))),_:1}),(0,t.bF)(o.D,{color:"grey darken-1",onClick:e.closeDeleteDialog},{default:(0,t.k6)((()=>l[18]||(l[18]=[(0,t.eW)("取消")]))),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])}var C=a(657),S=a(7617),W=a(8174);const E=W.A,L=(0,C.nY)("playerStore",{state:()=>({players:[]}),getters:{getPlayerById:e=>l=>e.players.find((e=>e.id===l)),ForSelectPlayerList(e){return e.players.filter((e=>e.allow_select))},NotForSelectPlayerList(e){return e.players.filter((e=>!e.allow_select))}},actions:{async fetchPlayers(){try{const e=(0,S.rJ)(E,"players"),l=await(0,S.GG)(e);this.players=l.docs.map((e=>({id:e.id,...e.data()})))}catch(e){console.error("Error fetching players:",e),alert("无法加载玩家列表，请重试。")}},async toggleAllowSelect(e){const l=this.players.find((l=>l.id===e));if(l){l.allow_select=!l.allow_select;const e=(0,S.H9)(W.A,"players",l.id);await(0,S.mZ)(e,{allow_select:l.allow_select})}},async addPlayer(e){try{e.allow_select=!0;const l=(0,S.rJ)(E,"players");await(0,S.gS)(l,e),this.fetchPlayers()}catch(l){console.error("Error adding player:",l),alert("无法添加玩家，请重试。")}},async updatePlayer(e,l){try{const a=(0,S.H9)(E,"players",e);await(0,S.mZ)(a,l),this.fetchPlayers()}catch(a){console.error("Error updating player:",a),alert("无法更新玩家，请重试。")}},async deletePlayer(e){try{const l=(0,S.H9)(E,"players",e);await(0,S.kd)(l),this.fetchPlayers()}catch(l){console.error("Error deleting player:",l),alert("无法删除玩家，请重试。")}}}});var A=(0,t.pM)({name:"PlayerPage",setup(){const e=L();return{playerStore:e}},computed:{players(){return this.playerStore.players},forSelectPlayers(){return this.playerStore.ForSelectPlayerList},notForSelectPlayers(){return this.playerStore.NotForSelectPlayerList}},data(){return{headers:[{title:"ID",key:"id"},{title:"玩家固定名称",key:"player_name"},{title:"玩家显示名称",key:"player_display_name"},{title:"操作",value:"actions",sortable:!1}],dialog:!1,deleteDialog:!1,editingPlayer:!1,player:{player_name:"",player_display_name:""},sameName:!0,confirmedDeleteId:null}},methods:{openDialog(){this.dialog=!0,this.editingPlayer=!1,this.player={player_name:"",player_display_name:""},this.sameName=!0},closeDialog(){this.dialog=!1},confirmDeletePlayer(e){this.deleteDialog=!0,this.confirmedDeleteId=e},closeDeleteDialog(){this.deleteDialog=!1,this.confirmedDeleteId=null},syncDisplayName(){this.sameName&&(this.player.player_display_name=this.player.player_name)},editPlayer(e){this.dialog=!0,this.editingPlayer=!0,this.player={...e}},async toggleAllowSelect(e){this.playerStore.toggleAllowSelect(e)},async deletePlayer(e){await this.playerStore.deletePlayer(e),this.closeDeleteDialog()},async savePlayer(){this.editingPlayer?await this.playerStore.updatePlayer(this.player.id,{player_display_name:this.player.player_display_name}):(this.sameName&&(this.player.player_display_name=this.player.player_name),console.log(this.player),await this.playerStore.addPlayer(this.player)),this.closeDialog()}},created(){this.playerStore.fetchPlayers()}}),x=a(1241);const N=(0,x.A)(A,[["render",V]]);var I=N},1772:function(e,l,a){a.d(l,{p:function(){return k}});var t=a(6768),r=a(6856),o=a(7852),n=a(475),i=a(1950),s=a(2067),d=a(2876),c=a(144),u=a(4587),y=a(1247),p=a(9094),m=a(6993),f=a(4600);const h=(0,u.j)({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...(0,n.D)({origin:"center center",scrollStrategy:"block",transition:{component:r._},zIndex:2400})},"VDialog"),k=(0,y.RW)()({name:"VDialog",props:h(),emits:{"update:modelValue":e=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(e,l){let{emit:a,slots:r}=l;const u=(0,s.q)(e,"modelValue"),{scopeId:y}=(0,d.b)(),h=(0,c.KR)();function k(e){const l=e.relatedTarget,a=e.target;if(l!==a&&h.value?.contentEl&&h.value?.globalTop&&![document,h.value.contentEl].includes(a)&&!h.value.contentEl.contains(a)){const e=(0,p.OW)(h.value.contentEl);if(!e.length)return;const a=e[0],t=e[e.length-1];l===a?t.focus():a.focus()}}function g(){a("afterEnter"),h.value?.contentEl&&!h.value.contentEl.contains(document.activeElement)&&h.value.contentEl.focus({preventScroll:!0})}function _(){a("afterLeave")}return m.ZK&&(0,t.wB)((()=>u.value&&e.retainFocus),(e=>{e?document.addEventListener("focusin",k):document.removeEventListener("focusin",k)}),{immediate:!0}),(0,t.wB)(u,(async e=>{e||(await(0,t.dY)(),h.value.activatorEl?.focus({preventScroll:!0}))})),(0,f.C)((()=>{const l=n.L.filterProps(e),a=(0,t.v6)({"aria-haspopup":"dialog"},e.activatorProps),i=(0,t.v6)({tabindex:-1},e.contentProps);return(0,t.bF)(n.L,(0,t.v6)({ref:h,class:["v-dialog",{"v-dialog--fullscreen":e.fullscreen,"v-dialog--scrollable":e.scrollable},e.class],style:e.style},l,{modelValue:u.value,"onUpdate:modelValue":e=>u.value=e,"aria-modal":"true",activatorProps:a,contentProps:i,role:"dialog",onAfterEnter:g,onAfterLeave:_},y),{activator:r.activator,default:function(){for(var e=arguments.length,l=new Array(e),a=0;a<e;a++)l[a]=arguments[a];return(0,t.bF)(o.K,{root:"VDialog"},{default:()=>[r.default?.(...l)]})}})})),(0,i.O)({},h)}})}}]);
//# sourceMappingURL=294.1eba7920.js.map