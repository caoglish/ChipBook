"use strict";(self["webpackChunkchipbook"]=self["webpackChunkchipbook"]||[]).push([[352],{6352:function(e,t,a){a.r(t),a.d(t,{default:function(){return f}});var r=a(6768),s=a(4232),i=a(266),l=a(554),o=a(6329);const n=e=>((0,r.Qi)("data-v-5737520c"),e=e(),(0,r.jt)(),e),c=n((()=>(0,r.Lk)("h2",null,"游戏历史记录",-1)));function m(e,t,a,n,m,d){return(0,r.uX)(),(0,r.CE)("div",null,[c,e.showDeleteAlert?((0,r.uX)(),(0,r.Wv)(i.l,{key:0,type:"success",dismissible:"",onInput:t[0]||(t[0]=t=>e.showDeleteAlert=!1),class:"my-4"},{default:(0,r.k6)((()=>[(0,r.eW)(" 游戏记录已成功删除。 ")])),_:1})):(0,r.Q3)("",!0),(0,r.bF)(o.Py,{headers:e.historyHeaders,items:e.games,class:"mt-4"},{"item.actions":(0,r.k6)((({item:t})=>[(0,r.bF)(l.D,{color:"primary",onClick:a=>e.viewGame(t.id)},{default:(0,r.k6)((()=>[(0,r.eW)("查看")])),_:2},1032,["onClick"]),0===t.player_count?((0,r.uX)(),(0,r.Wv)(l.D,{key:0,color:"error",onClick:a=>e.confirmDelete(t)},{default:(0,r.k6)((()=>[(0,r.eW)("删除")])),_:2},1032,["onClick"])):(0,r.Q3)("",!0)])),"item.created_at":(0,r.k6)((({item:e})=>[(0,r.Lk)("span",null,(0,s.v_)(e.created_at),1)])),"item.summary":(0,r.k6)((({item:e})=>[(0,r.Lk)("span",{style:(0,s.Tr)({color:e.summary?"green":"red"})},(0,s.v_)(e.summary?"有":"无"),5)])),_:1},8,["headers","items"])])}a(4114);var d=a(7617),h=a(8174),u=a(9077);const y=h.A;var k=(0,r.pM)({name:"History",data(){return{games:[],showDeleteAlert:!1,loading:!1,historyHeaders:[{title:"游戏ID",key:"id"},{title:"创建时间",key:"created_at"},{title:"玩家数量",key:"player_count"},{title:"每手筹码",key:"chips_per_hand"},{title:"每手金额",key:"amount_per_hand"},{title:"总结",key:"summary"},{title:"操作",key:"actions",sortable:!1}]}},methods:{async fetchAllGames(){if(!this.loading){this.loading=!0;try{const e=(0,d.rJ)(y,"games"),t=await(0,d.GG)(e),a=t.docs.map((async e=>{const t=e.data();console.log(t);const a=e.id,r=(0,d.rJ)(y,`games/${a}/players`),s=await(0,d.GG)(r),i=s.size;return{id:a,created_at:(0,u.JO)(new Date(t.created_at)),sortfield:new Date(t.created_at),player_count:i,chips_per_hand:t.chips_per_hand,amount_per_hand:t.amount_per_hand,summary:t.hasOwnProperty("summary")}})),r=await Promise.all(a);this.games=r.sort(((e,t)=>t.sortfield-e.sortfield))}catch(e){console.error("Error fetching all games:",e),alert("无法加载游戏历史，请重试。")}finally{this.loading=!1}}},viewGame(e){this.$router.push({name:"GameManagement",params:{gameId:e}})},async confirmDelete(e){const t=confirm(`您确定要删除游戏 ${e.id} 吗？此操作不可撤销。`);t&&await this.deleteGame(e.id)},async deleteGame(e){try{const t=(0,d.H9)(y,"games",e);await(0,d.kd)(t),this.games=this.games.filter((t=>t.id!==e)),this.showDeleteAlert=!0,setTimeout((()=>{this.showDeleteAlert=!1}),3e3)}catch(t){console.error("Error deleting game:",t),alert("删除游戏记录时出错，请重试。")}}},created(){this.fetchAllGames()}}),p=a(1241);const _=(0,p.A)(k,[["render",m],["__scopeId","data-v-5737520c"]]);var f=_}}]);
//# sourceMappingURL=352.fe7d269b.js.map