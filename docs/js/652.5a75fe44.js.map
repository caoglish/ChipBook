{"version":3,"file":"js/652.5a75fe44.js","mappings":"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","sources":["webpack://chipbook/./src/views/HistoryView.vue","webpack://chipbook/./src/views/HistoryView.vue?e071"],"sourcesContent":["<template>\r\n\t<div>\r\n\t\t<h2>游戏历史记录</h2>\r\n\r\n\t\t<!-- 删除成功的提示消息 -->\r\n\t\t<v-alert v-if=\"showDeleteAlert\" type=\"success\" dismissible @input=\"showDeleteAlert = false\" class=\"my-4\">\r\n\t\t\t游戏记录已成功删除。\r\n\t\t</v-alert>\r\n\t\t<v-data-table :headers=\"historyHeaders\" :items=\"games\" class=\"mt-4\">\r\n\t\t\t<template #item.actions=\"{ item }\">\r\n\t\t\t\t<v-btn color=\"primary\" @click=\"viewGame(item.id)\">查看</v-btn>\r\n\t\t\t\t<v-btn color=\"error\" @click=\"confirmDelete(item)\" v-if=\"item.player_count === 0\">删除</v-btn>\r\n\t\t\t</template>\r\n\t\t\t<template #item.created_at=\"{ item }\">\r\n\t\t\t\t<span>{{ item.created_at }}</span>\r\n\t\t\t</template>\r\n\t\t\t<template #item.summary=\"{ item }\">\r\n\t\t\t\t<span :style=\"{ color: item.summary ? 'green' : 'red' }\">{{ item.summary ? \"有\" : \"无\" }}</span>\r\n\t\t\t</template>\r\n\t\t</v-data-table>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\nimport { defineComponent } from \"vue\";\r\nimport { collection, getDocs, deleteDoc, doc } from \"firebase/firestore\";\r\nimport firebaseDb from \"@/Lib/FirebaseDb\";\r\nimport { dateDisplay } from \"@/Lib/DateHelper\";\r\n\r\nconst db = firebaseDb;\r\n\r\nexport default defineComponent({\r\n\tname: \"History\",\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tgames: [], // 所有游戏的列表\r\n\t\t\tshowDeleteAlert: false, // 控制删除成功消息的显示状态\r\n\t\t\tloading: false, // 防止多次触发请求\r\n\t\t\thistoryHeaders: [\r\n\t\t\t\t{ title: \"游戏ID\", key: \"id\" },\r\n\t\t\t\t{ title: \"创建时间\", key: \"created_at\" },\r\n\t\t\t\t{ title: \"玩家数量\", key: \"player_count\" },\r\n\t\t\t\t{ title: \"每手筹码\", key: \"chips_per_hand\" },\r\n\t\t\t\t{ title: \"每手金额\", key: \"amount_per_hand\" },\r\n\t\t\t\t{ title: \"总结\", key: \"summary\" },\r\n\t\t\t\t{ title: \"操作\", key: \"actions\", sortable: false },\r\n\t\t\t],\r\n\t\t};\r\n\t},\r\n\tmethods: {\r\n\t\tasync fetchAllGames() {\r\n\t\t\tif (this.loading) return; // 防止多次请求\r\n\t\t\tthis.loading = true;\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst gamesRef = collection(db, \"games\");\r\n\t\t\t\tconst querySnapshot = await getDocs(gamesRef);\r\n\t\t\t\tconst gameDataPromises = querySnapshot.docs.map(async (doc) => {\r\n\t\t\t\t\tconst data = doc.data();\r\n\t\t\t\t\tconsole.log(data);\r\n\t\t\t\t\tconst gameId = doc.id;\r\n\r\n\t\t\t\t\t// 获取players子集合中的文档数量\r\n\t\t\t\t\tconst playersRef = collection(db, `games/${gameId}/players`);\r\n\t\t\t\t\tconst playersSnapshot = await getDocs(playersRef);\r\n\t\t\t\t\tconst playerCount = playersSnapshot.size; // 子集合中文档的数量\r\n\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tid: gameId,\r\n\t\t\t\t\t\tcreated_at: dateDisplay(new Date(data.created_at)),\r\n\t\t\t\t\t\tsortfield: new Date(data.created_at),\r\n\t\t\t\t\t\tplayer_count: playerCount,\r\n\t\t\t\t\t\tchips_per_hand: data.chips_per_hand,\r\n\t\t\t\t\t\tamount_per_hand: data.amount_per_hand,\r\n\t\t\t\t\t\tsummary: data.hasOwnProperty(\"summary\"),\r\n\t\t\t\t\t};\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// 等待所有Promise完成后排序\r\n\t\t\t\tconst games = await Promise.all(gameDataPromises);\r\n\r\n\t\t\t\t// 按创建时间排序（最新的在前）\r\n\t\t\t\tthis.games = games.sort((a, b) => b.sortfield - a.sortfield);\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error(\"Error fetching all games:\", error);\r\n\t\t\t\talert(\"无法加载游戏历史，请重试。\");\r\n\t\t\t} finally {\r\n\t\t\t\tthis.loading = false;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tviewGame(gameId) {\r\n\t\t\t// 跳转到GameManagement页面，并传递gameId\r\n\t\t\tthis.$router.push({ name: \"GameManagement\", params: { gameId } });\r\n\t\t},\r\n\t\tasync confirmDelete(game) {\r\n\t\t\tconst confirmation = confirm(`您确定要删除游戏 ${game.id} 吗？此操作不可撤销。`);\r\n\t\t\tif (confirmation) {\r\n\t\t\t\tawait this.deleteGame(game.id);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tasync deleteGame(gameId) {\r\n\t\t\ttry {\r\n\t\t\t\tconst gameRef = doc(db, \"games\", gameId);\r\n\t\t\t\tawait deleteDoc(gameRef);\r\n\t\t\t\tthis.games = this.games.filter(game => game.id !== gameId); // 从列表中移除已删除的游戏\r\n\t\t\t\tthis.showDeleteAlert = true; // 显示删除成功的提示消息\r\n\r\n\t\t\t\t// 在 3 秒后自动隐藏提示消息\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.showDeleteAlert = false;\r\n\t\t\t\t}, 3000);\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error(\"Error deleting game:\", error);\r\n\t\t\t\talert(\"删除游戏记录时出错，请重试。\");\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n\tcreated() {\r\n\t\tthis.fetchAllGames();\r\n\t},\r\n});\r\n</script>\r\n\r\n<style scoped>\r\n.v-btn {\r\n\tmargin: 10px;\r\n}\r\n</style>\r\n","import { render } from \"./HistoryView.vue?vue&type=template&id=439cb41b&scoped=true\"\nimport script from \"./HistoryView.vue?vue&type=script&lang=js\"\nexport * from \"./HistoryView.vue?vue&type=script&lang=js\"\n\nimport \"./HistoryView.vue?vue&type=style&index=0&id=439cb41b&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-439cb41b\"]])\n\nexport default __exports__"],"names":["_createElementVNode","_createElementBlock","_hoisted_1","_ctx","showDeleteAlert","_createBlock","_component_v_alert","key","type","dismissible","onInput","_cache","$event","class","default","_withCtx","_createTextVNode","_","_createCommentVNode","_createVNode","_component_v_data_table","headers","historyHeaders","items","games","item","_component_v_btn","color","onClick","viewGame","id","player_count","confirmDelete","_toDisplayString","created_at","style","_normalizeStyle","summary","db","firebaseDb","defineComponent","name","data","loading","title","sortable","methods","fetchAllGames","this","gamesRef","collection","querySnapshot","getDocs","gameDataPromises","docs","map","async","doc","console","log","gameId","playersRef","playersSnapshot","playerCount","size","dateDisplay","Date","sortfield","chips_per_hand","amount_per_hand","hasOwnProperty","Promise","all","sort","a","b","error","alert","$router","push","params","game","confirmation","confirm","deleteGame","gameRef","deleteDoc","filter","setTimeout","created","__exports__","render"],"sourceRoot":""}